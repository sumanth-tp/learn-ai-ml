---
title: Merging, Joining, and Concatenating DataFrames
sidebar_label: Merging, Joining, and Concatenating DataFrames
sidebar_position: 8
---

## Introduction

In real-world data analysis, you rarely work with a single dataset. Instead, you
often need to **combine multiple DataFrames** that share some relationship.
Pandas provides three powerful methods for this purpose:

1. **Concatenation (`pd.concat`)** – glues multiple DataFrames together.
2. **Merging (`pd.merge`)** – combines DataFrames based on one or more key
   columns (like SQL joins).
3. **Joining (`DataFrame.join`)** – merges DataFrames based on their **index**
   values.

Each serves a slightly different purpose, and understanding when to use each is
vital for data wrangling and preprocessing.

---

## Creating Example DataFrames

Let’s create three simple DataFrames using dictionaries:

```python
import pandas as pd
import numpy as np

df1 = pd.DataFrame({'A': ['A0', 'A1', 'A2', 'A3'],
                    'B': ['B0', 'B1', 'B2', 'B3'],
                    'C': ['C0', 'C1', 'C2', 'C3'],
                    'D': ['D0', 'D1', 'D2', 'D3']},
                    index=[0, 1, 2, 3])

df2 = pd.DataFrame({'A': ['A4', 'A5', 'A6', 'A7'],
                    'B': ['B4', 'B5', 'B6', 'B7'],
                    'C': ['C4', 'C5', 'C6', 'C7'],
                    'D': ['D4', 'D5', 'D6', 'D7']},
                    index=[4, 5, 6, 7])

df3 = pd.DataFrame({'A': ['A8', 'A9', 'A10', 'A11'],
                    'B': ['B8', 'B9', 'B10', 'B11'],
                    'C': ['C8', 'C9', 'C10', 'C11'],
                    'D': ['D8', 'D9', 'D10', 'D11']},
                    index=[8, 9, 10, 11])
```

Each DataFrame has the same structure (columns **A–D**) but different rows.

---

## Concatenation of DataFrames

Concatenation “glues” DataFrames together — either **vertically (rows)** or
**horizontally (columns)**.

### 1. Vertical Concatenation (Default: `axis=0`)

```python
pd.concat([df1, df2, df3])
```

**Output:**

```
      A    B    C    D
0    A0   B0   C0   D0
1    A1   B1   C1   D1
...
11  A11  B11  C11  D11
```

- Stacks DataFrames **on top of each other**.
- Indices are preserved (0–11).

---

### 2. Horizontal Concatenation (`axis=1`)

```python
pd.concat([df1, df2, df3], axis=1)
```

**Output:**

```
     A   B   C   D    A   B   C   D    A   B   C   D
0   A0  B0  C0  D0  NaN NaN NaN NaN  NaN NaN NaN NaN
...
8  NaN NaN NaN NaN  NaN NaN NaN NaN  A8  B8  C8  D8
```

- Aligns along **columns** instead of rows.
- Missing data (where indices don’t align) appear as `NaN`.

> ⚠️ Ensure consistent indices when concatenating along columns.

---

## Merging DataFrames

`merge()` is similar to SQL joins. It combines rows based on **common key
columns**.

### Example

```python
left = pd.DataFrame({
    'key': ['K0', 'K1', 'K2', 'K3'],
    'A': ['A0', 'A1', 'A2', 'A3'],
    'B': ['B0', 'B1', 'B2', 'B3']
})

right = pd.DataFrame({
    'key': ['K0', 'K1', 'K2', 'K3'],
    'C': ['C0', 'C1', 'C2', 'C3'],
    'D': ['D0', 'D1', 'D2', 'D3']
})

pd.merge(left, right, on='key')
```

**Output:**

```
   key   A   B   C   D
0  K0  A0  B0  C0  D0
1  K1  A1  B1  C1  D1
2  K2  A2  B2  C2  D2
3  K3  A3  B3  C3  D3
```

---

### 1. Merging on Multiple Keys

```python
pd.merge(left, right, on=['key1', 'key2'])
```

Used when you have **multiple columns as join keys**.

---

### 2. Merge Types (`how` Parameter)

| Type      | Description      | Behavior                                           |
| --------- | ---------------- | -------------------------------------------------- |
| **inner** | Default          | Keeps only matching keys in both DataFrames        |
| **outer** | Union            | Keeps all keys, filling missing values with NaN    |
| **left**  | Left outer join  | Keeps all keys from left, fills missing from right |
| **right** | Right outer join | Keeps all keys from right, fills missing from left |

Example:

```python
pd.merge(left, right, how='outer', on='key')
```

---

## Joining DataFrames (Based on Index)

`join()` is a convenient shortcut for merging on indices instead of columns.

```python
left = pd.DataFrame({'A': ['A0', 'A1', 'A2'],
                     'B': ['B0', 'B1', 'B2']},
                     index=['K0', 'K1', 'K2'])

right = pd.DataFrame({'C': ['C0', 'C2', 'C3'],
                      'D': ['D0', 'D2', 'D3']},
                      index=['K0', 'K2', 'K3'])

left.join(right, how='inner')
```

**Output:**

```
     A   B   C   D
K0  A0  B0  C0  D0
K2  A2  B2  C2  D2
```

- Joins on the **index** by default.
- You can specify join types (`inner`, `outer`, `left`, `right`).

---

## Advanced Examples

### 1. Outer Join on Index

```python
left.join(right, how='outer')
```

Includes all index values from both DataFrames, filling missing values with
`NaN`.

---

### 2. Merging with Different Column Names

```python
pd.merge(left, right, left_on='key_left', right_on='key_right')
```

Useful when join columns have **different names**.

---

### 3. Concatenating with Keys (MultiIndex)

```python
pd.concat([df1, df2], keys=['Batch1', 'Batch2'])
```

Creates a **hierarchical index** to differentiate data sources.

---

### 4. Joining on Both Index and Column

```python
df1.join(df2, on='key_column', how='left')
```

Combines index-based and key-based joins in one statement.

---

## Key Takeaways

1. **Concatenation (`pd.concat`)** — Glues DataFrames together along rows or
   columns.
2. **Merging (`pd.merge`)** — Combines DataFrames on one or more key columns
   (similar to SQL).
3. **Joining (`df.join`)** — Combines DataFrames based on their **indices**.
4. Always check **alignment (axis)** and **join type (inner, outer, left,
   right)** to ensure correct results.
5. Use `keys` in concatenation to create a **hierarchical index** for tracking
   data sources.

---

## Practice Questions

1. What is the key difference between `merge()` and `join()`?
2. How does concatenation differ from merging?
3. Write code to concatenate three DataFrames vertically.
4. How do you merge two DataFrames on multiple key columns?
5. Which parameter controls the type of join in `merge()`?
6. Write a one-liner to merge two DataFrames on index using an outer join.
7. What happens when you concatenate along `axis=1` but indices don’t match?
8. How can you assign hierarchical keys while concatenating DataFrames?

---

## Answers

1. `merge()` joins on **columns**, while `join()` joins on **indices**.
2. Concatenation appends DataFrames (without key matching), while merging aligns
   rows based on **common keys**.
3. ```python
   pd.concat([df1, df2, df3])
   ```
4. ```python
   pd.merge(df1, df2, on=['key1', 'key2'])
   ```
5. The `how` parameter.
6. ```python
   left.join(right, how='outer')
   ```
7. Missing values (`NaN`) appear where index alignment fails.
8. ```python
   pd.concat([df1, df2], keys=['Batch1', 'Batch2'])
   ```
