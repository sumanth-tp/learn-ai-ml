---

title: Matplotlib Cheatsheet
sidebar_label: Matplotlib Cheatsheet
sidebar_position: 22
--------------------

# Matplotlib Cheatsheet — Industry‑Grade, In‑Depth

A practical, production‑ready reference for Python’s plotting workhorse. Focuses
on the **object‑oriented (OO)** API, performance, styling, export quality, and
common recipes used at work.

---

## 0) Mental Model & Vocabulary

- **Figure**: the top‑level container (window or page). Size in inches, DPI
  controls pixel output.
- **Axes**: a drawing area inside a Figure (what most people call a “plot”). A
  Figure can have multiple Axes.
- **Axis**: the x or y axis object inside an Axes (ticks, labels, grid belong
  here).
- **Artist**: anything that can be drawn (Line2D, Patch, Text, Image, etc.).
- **Pyplot state-machine (`matplotlib.pyplot`)**: convenience layer that
  implicitly creates figures/axes. Good for quick demos. **Prefer the OO style**
  in real projects.
- **Backends**: renderers (Agg for files, Qt/nbAgg for interactive, etc.).
- **rcParams**: global style configuration. Use context managers or
  project‑level style files to keep things consistent.

---

## 1) Minimal Patterns (OO First)

### 1.1 One figure, one axes

```python
import matplotlib.pyplot as plt

fig, ax = plt.subplots(figsize=(6, 4), dpi=150)
ax.plot([0, 1, 2], [0, 1, 0], linewidth=2)
ax.set(title="Title", xlabel="X", ylabel="Y")
ax.grid(True)
fig.tight_layout()         # or: fig.set_layout_engine('constrained')
fig.savefig("plot.png")
```

### 1.2 Multiple subplots

```python
fig, axs = plt.subplots(2, 2, figsize=(8, 6), dpi=150, sharex=False, sharey=False)
axs = axs.ravel()
for i, ax in enumerate(axs):
    ax.plot(range(10), [j**(i+1)/10 for j in range(10)])
    ax.set_title(f"Panel {i+1}")
fig.tight_layout()
```

### 1.3 Mixing with pandas (still OO)

```python
import pandas as pd

fig, ax = plt.subplots()
df = pd.DataFrame({"x": range(10), "y": [v**2 for v in range(10)]})
ax.plot(df["x"], df["y"], marker="o")
```

> **Rule of thumb**: Create `fig, ax = plt.subplots(...)`, then call
> `ax.<method>(...)`. Avoid `plt.<function>` once you have `ax`.

---

## 2) Figure Layouts Like a Pro

- **`plt.subplots(nrows, ncols)`**: quick grids.
- **`GridSpec`**: flexible grids with uneven widths/heights.
- **`subplot_mosaic`**: name subplots as a layout map.
- **`constrained_layout` vs `tight_layout`**: prefer `constrained_layout` for
  modern Matplotlib (handles colorbars/insets better). Example:

```python
fig = plt.figure(layout='constrained', figsize=(8, 5))
gs = fig.add_gridspec(2, 3)
ax_main = fig.add_subplot(gs[:, :2])
ax_side = fig.add_subplot(gs[:, 2])
```

- **Insets** (zoom or legend panes):

```python
from mpl_toolkits.axes_grid1.inset_locator import inset_axes, mark_inset

fig, ax = plt.subplots()
ax_in = inset_axes(ax, width="30%", height="30%", loc='upper right')
# draw on ax and ax_in
```

---

## 3) Axes API Essentials

Common plotters:

```python
ax.plot(x, y, linewidth=2, linestyle='-', marker='o')
ax.scatter(x, y, s=30, alpha=0.8)
ax.bar(categories, values)
ax.barh(categories, values)
ax.hist(data, bins=30, density=False)
ax.boxplot(series)
ax.violinplot(series)
ax.stem(x, y)
ax.fill_between(x, y1, y2)
ax.imshow(image_array, aspect='auto', origin='upper')
ax.pcolormesh(X, Y, Z)
ax.contour(X, Y, Z)
ax.contourf(X, Y, Z)
```

Axis & labels:

```python
ax.set_title("Title")
ax.set_xlabel("X label")
ax.set_ylabel("Y label")
ax.set_xlim(xmin, xmax)
ax.set_ylim(ymin, ymax)
ax.set(xlabel="X", ylabel="Y", xscale='linear', yscale='log')
```

Grid & spines:

```python
ax.grid(True, which='major')
ax.minorticks_on()
for side in ("top", "right"):
    ax.spines[side].set_visible(False)
```

Legend:

```python
line1, = ax.plot(x, y1, label="Series A")
line2, = ax.plot(x, y2, label="Series B")
ax.legend(loc='best', ncol=1, frameon=True, title="Legend")
```

---

## 4) Styling & rcParams (Team/Brand Consistency)

### 4.1 Project‑level style

- Create `mplstyle` file (e.g., `corp.mplstyle`) and version it with your repo.
- Activate globally or per plot:

```python
import matplotlib as mpl
mpl.rc_file_defaults()                # reset to defaults when needed
mpl.rcParams.update({"font.size": 10, "axes.titlesize": 12})
# or context:
import matplotlib.pyplot as plt
with plt.rc_context({"figure.dpi": 150, "axes.grid": True}):
    fig, ax = plt.subplots()
```

- Use **Cycler** for line styles:

```python
from cycler import cycler
mpl.rcParams['axes.prop_cycle'] = cycler('linestyle', ['-', '--', ':', '-.'])
```

### 4.2 Fonts (incl. local language scripts)

- Install fonts system‑wide, then point Matplotlib:

```python
mpl.rcParams.update({
    "font.family": "DejaVu Sans",        # or corporate font
    "mathtext.fontset": "dejavusans",
})
```

- For Devanagari or other Indic scripts, ensure a font with those glyphs and set
  `font.family` to it.

### 4.3 Color & Colormaps

- Prefer perceptually uniform maps (e.g., `viridis`, `cividis`).
- For quantitative heatmaps:

```python
import matplotlib.colors as mcolors
norm = mcolors.Normalize(vmin=vmin, vmax=vmax)  # or LogNorm
im = ax.imshow(Z, cmap='viridis', norm=norm)
fig.colorbar(im, ax=ax, orientation='vertical')
```

- **Accessibility**: ensure contrast; distinguish series with line style +
  marker, not color alone.

---

## 5) Ticks, Locators, Formatters

```python
import matplotlib.ticker as mticker

ax.xaxis.set_major_locator(mticker.MaxNLocator(5))
ax.xaxis.set_minor_locator(mticker.AutoMinorLocator())
ax.yaxis.set_major_formatter(mticker.ScalarFormatter(useMathText=True))
ax.tick_params(axis='both', which='both', direction='out', length=5)
```

**Date/time**:

```python
import matplotlib.dates as mdates
ax.xaxis.set_major_locator(mdates.MonthLocator(interval=3))
ax.xaxis.set_major_formatter(mdates.DateFormatter('%b %Y'))
fig.autofmt_xdate()
```

**Custom formatting**:

```python
def pct(x, _pos):
    return f"{100*x:.0f}%"
ax.yaxis.set_major_formatter(mticker.FuncFormatter(pct))
```

---

## 6) Scales & Secondary Axes

- Scales: `'linear'`, `'log'`, `'symlog'`, `'logit'`.

```python
ax.set_xscale('log')
ax.set_yscale('symlog', linthresh=1)
```

- Twin axes vs secondary transforms:

```python
ax2 = ax.twinx()  # shares x, new y

# Secondary axis with transform function
import numpy as np
secax = ax.secondary_yaxis('right', functions=(np.deg2rad, np.rad2deg))
secax.set_ylabel('radians')
```

---

## 7) Annotations & Text (with Transforms)

```python
ax.text(0.05, 0.95, "Note", transform=ax.transAxes, va='top')
ax.annotate(
    "Peak", xy=(x0, y0), xytext=(x0, y0+5),
    arrowprops=dict(arrowstyle='->', shrinkA=0, shrinkB=0)
)
```

- **Coordinate systems**: `data`, `axes fraction (0–1)`, `figure fraction`.
- Use `transform=ax.transAxes` to anchor labels relative to the axes box.

---

## 8) Images, Heatmaps, and Colorbars

```python
im = ax.imshow(Z, cmap='viridis', origin='upper', aspect='auto')
cb = fig.colorbar(im, ax=ax, shrink=0.9, pad=0.02, aspect=30)
cb.set_label('Intensity')
```

- With `pcolormesh` for irregular grids. Use `shading='auto'` to avoid warnings.
- Normalize with `LogNorm` for wide‑range data.

---

## 9) Error Bars & Uncertainty

```python
ax.errorbar(x, y, yerr=err, fmt='o', capsize=3)
ax.fill_between(x, y-err, y+err, alpha=0.3)
```

- Consider asymmetric errors: `yerr=[ylo, yhi]`.
- For categorical comparisons, box/violin plots with clear medians and IQR.

---

## 10) Legends That Don’t Lie

- Only show what’s needed; title the legend.
- For size/color in scatter legends, build **proxy artists**:

```python
from matplotlib.lines import Line2D
legend_handles = [Line2D([0], [0], marker='o', linestyle='', label='Small', markersize=4)]
ax.legend(handles=legend_handles, title='Size')
```

- Positioning: `loc='best'` or fine‑tune `bbox_to_anchor`.

---

## 11) Export for Reports & Papers

```python
fig.set_size_inches(6.0, 4.0)
fig.savefig(
    "figure.pdf", dpi=300, bbox_inches='tight',
    facecolor='white', transparent=False, metadata={"Title": "My Figure"}
)
```

- **Vector vs Raster**: use PDF/SVG for line art, PNG for images/heatmaps.
- Consistent sizing: decide single/1.5/double column widths (e.g., 3.3/5/7
  inches) across your report.
- Fonts: embed via PDF; avoid font substitution by using common fonts.

---

## 12) Performance Playbook

- **Avoid re‑plotting** in loops; **update artists** instead:

```python
line, = ax.plot(x, y)
for frame in frames:
    line.set_ydata(next_y)
    fig.canvas.draw_idle()
```

- Turn on **blitting** in animations (see §14).
- For huge scatters: use `ax.scatter(..., rasterized=True)` to rasterize the
  collection in vector outputs.
- Simplify paths: `mpl.rcParams['path.simplify'] = True` and
  `agg.path.chunksize` for very long lines.
- Use smaller `dpi` during development; raise only for final export.

---

## 13) Interactivity & Events

```python
def on_click(event):
    if event.inaxes is ax:
        print(event.xdata, event.ydata)

cid = fig.canvas.mpl_connect('button_press_event', on_click)
```

- Other events: `'key_press_event'`, `'motion_notify_event'`, `'pick_event'`.
- Make artists pickable: `artist.set_picker(True)`.

---

## 14) Animation (FuncAnimation)

```python
from matplotlib.animation import FuncAnimation

fig, ax = plt.subplots()
line, = ax.plot([], [])

def init():
    ax.set_xlim(0, 2)
    ax.set_ylim(-1, 1)
    line.set_data([], [])
    return (line,)

def update(frame):
    x = frame
    y = np.sin(2*np.pi*x)
    line.set_data([0, x], [0, y])
    return (line,)

ani = FuncAnimation(fig, update, frames=np.linspace(0, 2, 100), init_func=init, blit=True)
# ani.save('anim.mp4', fps=30, dpi=150)
```

- Prefer `blit=True` when possible.
- Writers: `ffmpeg`, `imagemagick`, `Pillow`.

---

## 15) 3D (Use Sparingly)

```python
from mpl_toolkits.mplot3d import Axes3D  # noqa: F401
fig = plt.figure()
ax = fig.add_subplot(111, projection='3d')
ax.plot3D(x, y, z)
ax.set_box_aspect((1, 1, 0.7))
```

- 3D is harder to read; use when necessary (surfaces, trajectories). Provide
  multiple views or interactivity.

---

## 16) Common Recipes

### 16.1 Twin/secondary axis with shared x

```python
ax2 = ax.twinx()
ax.set_ylabel('°C')
ax2.set_ylabel('% humidity')
```

### 16.2 Broken axis (skip a range)

```python
fig, (ax, ax2) = plt.subplots(2, 1, sharex=True)
ax.set_ylim(80, 100); ax2.set_ylim(0, 20)
ax.spines['bottom'].set_visible(False)
ax2.spines['top'].set_visible(False)
ax.xaxis.tick_top(); ax.tick_params(labeltop=False)
ax2.xaxis.tick_bottom()
```

### 16.3 Heatmap helper

```python
def heatmap(ax, data, xticklabels=None, yticklabels=None):
    im = ax.imshow(data, aspect='auto', origin='upper')
    if xticklabels is not None:
        ax.set_xticks(range(len(xticklabels)), xticklabels)
    if yticklabels is not None:
        ax.set_yticks(range(len(yticklabels)), yticklabels)
    return im
```

### 16.4 Confidence band

```python
ax.plot(x, y)
ax.fill_between(x, y_lo, y_hi, alpha=0.2)
```

### 16.5 Subplot mosaic (named panels)

```python
layout = """
AB
CC
"""
fig, axs = plt.subplot_mosaic(layout, figsize=(7,5), layout='constrained')
axs['A'].plot(x, y)
axs['B'].bar(cat, val)
axs['C'].hist(data)
```

---

## 17) Quality Checklist (Before You Save)

- Axes labels present, units included (e.g., "Speed (km/h)").
- Title concise, optional subtitle via anchored text.
- Tick formatting appropriate (no overlapping, scientific notation consistent).
- Legend titles and entries meaningful, no duplicates.
- Color choices perceptually uniform and accessible.
- Grid used sparingly; minor ticks enabled for precise reading.
- Exported size matches destination (slide, paper column, dashboard tile).
- Metadata set (title, author) if going to PDFs.

---

## 18) Troubleshooting & Gotchas

- **Cut‑off labels**: use `layout='constrained'` or `bbox_inches='tight'`.
- **Jupyter looks fine, file looks different**: different DPI/backends; fix
  `figsize` and `dpi` explicitly.
- **Legends hiding data**: use `bbox_to_anchor` or `loc='upper left'` with
  padding.
- **Massive SVG/PDF size**: rasterize heavy artists (`rasterized=True`) or
  export PNG for heatmaps.
- **Fonts not found**: call `matplotlib.font_manager.findSystemFonts()` and set
  `rcParams['font.family']`.

---

## 19) API Surface — Quick Reference

- **Figure**: `plt.figure`, `plt.subplots`, `fig.add_subplot`, `fig.colorbar`,
  `fig.savefig`
- **Axes**: `ax.plot`, `ax.scatter`, `ax.bar`, `ax.hist`, `ax.imshow`,
  `ax.contourf`, `ax.fill_between`, `ax.stem`, `ax.violinplot`, `ax.boxplot`
- **Labels**: `ax.set_title`, `ax.set_xlabel`, `ax.set_ylabel`, `ax.set_xlim`,
  `ax.set_ylim`
- **Legend**: `ax.legend`
- **Ticks**: `ax.tick_params`, `matplotlib.ticker.*`
- **Scales**: `ax.set_xscale`, `ax.set_yscale`
- **Transforms**: `ax.transData`, `ax.transAxes`, `ax.transFigure`
- **Layouts**: `plt.subplots`, `GridSpec`, `subplot_mosaic`,
  `layout='constrained'`
- **Colorbar**: `fig.colorbar` (needs a `ScalarMappable`, e.g., output of
  `imshow`/`pcolormesh`)
- **Animation**: `matplotlib.animation.FuncAnimation`
- **3D**: `projection='3d'` on `add_subplot`

---

## 20) Minimal, Reusable Plot Template (OO)

```python
import matplotlib as mpl
import matplotlib.pyplot as plt

DEFAULT_RC = {
    "figure.dpi": 150,
    "savefig.bbox": "tight",
    "axes.grid": True,
    "axes.spines.top": False,
    "axes.spines.right": False,
}

def new_fig_ax(width=6, height=4):
    with plt.rc_context(DEFAULT_RC):
        fig, ax = plt.subplots(figsize=(width, height))
    return fig, ax

# Usage
fig, ax = new_fig_ax()
ax.plot(x, y, linewidth=2)
ax.set(xlabel="X", ylabel="Y", title="My Plot")
fig.savefig("figure.png", dpi=300)
```

---

### Final Notes

- Prefer OO API for clarity and testability.
- Version your `mplstyle` and rcParams with the project.
- Design with the **final medium** in mind (paper width, slide, dashboard).
- Validate accessibility (contrast, colorblind safety, font size) before
  publishing.
