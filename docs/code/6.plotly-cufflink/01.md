---
title: Plotly
sidebar_label: Plotly
sidebar_position: 32
---

# Plotly (Modern) — Practical Guide with In-Depth Examples

This guide shows how to create interactive plots using **Plotly 5.x** with the
recommended APIs: **Plotly Express (`plotly.express`)** for high-level figures
and **Graph Objects (`plotly.graph_objects`)** for fine-grained control.

---

## Setup

```bash
pip install -U plotly kaleido pandas numpy
```

```python
import plotly, pandas as pd, numpy as np
print("plotly", plotly.__version__)  # 5.x recommended
```

Notes:

- `fig.show()` renders interactively in Jupyter/VS Code or opens a browser tab
  in plain Python.
- `kaleido` enables static image export (`fig.write_image(...)`).

---

## Sample Data

```python
import numpy as np, pandas as pd
np.random.seed(42)

df  = pd.DataFrame(np.random.randn(100, 4), columns=list("abcd"))
df2 = pd.DataFrame({"category": ["a", "b", "c"], "values": [32, 43, 50]})
```

---

## General Pattern

- **Create** a figure with `plotly.express` (or `graph_objects`).
- **Customize** using `fig.update_traces(...)` and `fig.update_layout(...)`.
- **Render** with `fig.show()` or **export** with `fig.write_html(...)` /
  `fig.write_image(...)`.

Key ideas:

- `update_traces` changes default styling of all traces (or matching traces via
  `selector=`).
- `update_layout` changes figure-level elements (title, axes, legend, margins,
  templates).
- Most arguments accept dicts; you can nest e.g.
  `marker=dict(size=10, line=dict(width=1, color="black"))`.

---

## Line Plot (multiple series)

```python
import plotly.express as px

fig = px.line(
    df,
    y=df.columns,                  # plot all columns a,b,c,d against index
    title="Line plot of a,b,c,d",
    template="plotly_white"        # clean background
)
fig.update_layout(hovermode="x unified")  # one tooltip per x-position
fig.show()
```

Why: Line is the default for time/sequence data; using `y=df.columns` lets you
toggle series in the legend.

---

## Scatter Plot (markers only)

```python
fig = px.scatter(
    df, x="a", y="b",
    title="Scatter: a vs b",
    template="plotly_white"
)
fig.update_traces(
    mode="markers",                # markers only
    marker=dict(size=10, opacity=0.8)
)
fig.update_xaxes(zeroline=True, zerolinecolor="#ccc")
fig.update_yaxes(zeroline=True, zerolinecolor="#ccc")
fig.show()
```

Notes:

- `mode="markers"` ensures no connecting lines.
- For dense plots, consider `opacity<1` to reduce overplotting.
- Use `hover_data=` to add more columns to tooltips.

---

## Bar Charts

### Categorical bars

```python
fig = px.bar(
    df2, x="category", y="values",
    title="Bar: category vs values",
    text="values",                 # show numbers on bars
    template="plotly_white"
)
fig.update_traces(textposition="outside")
fig.update_layout(uniformtext_minsize=10, uniformtext_mode="hide")
fig.show()
```

### Aggregated bars

```python
s = df.sum()                       # Series of column totals
fig = px.bar(
    x=s.index, y=s.values,
    labels={"x":"column","y":"sum"},
    title="Column sums",
    template="plotly_white"
)
fig.show()
```

Tips:

- For stacked/grouped bars with a tidy frame, pass `color=` and set `barmode` in
  layout: `fig.update_layout(barmode="group")` or `"relative"`.

---

## Box Plots (distributions per column)

```python
fig = px.box(
    df,
    title="Box plots by column",
    template="plotly_white",
    points=False                    # hide individual points
)
fig.show()
```

Notes:

- Box plots give median, IQR, and outliers quickly.
- Use `points="all"` to overlay jittered observations.

---

## Histograms

### Single variable with bins

```python
fig = px.histogram(
    df, x="a", nbins=25,
    title="Histogram of a",
    template="plotly_white", opacity=0.85
)
fig.update_layout(bargap=0.05)
fig.show()
```

### Overlaid histograms for all columns

```python
melted = df.melt(var_name="column", value_name="value")
fig = px.histogram(
    melted, x="value", color="column",
    barmode="overlay", opacity=0.45,
    title="Overlaid histograms",
    template="plotly_white"
)
fig.show()
```

Pitfall:

- Overlaid histograms can be hard to read if distributions are similar; consider
  `barmode="stack"` or a small multiple (facet).

---

## Bubble Plot (size encodes third variable)

```python
fig = px.scatter(
    df, x="a", y="b", size=df["c"].abs(),    # ensure nonnegative
    size_max=40,                              # upper bound in screen px
    title="Bubble plot (size from |c|)",
    template="plotly_white"
)
fig.show()
```

Notes:

- Use a nonnegative series for `size=`.
- Perceptually, area encodes value (size is radius proxy). Provide a legend via
  `size_max` and `size` scale.

---

## “Spread” / Shaded Difference Between Two Series

```python
import plotly.graph_objects as go

fig = go.Figure()
fig.add_trace(go.Scatter(y=df["a"], name="a", line=dict(color="#1f77b4")))
fig.add_trace(go.Scatter(
    y=df["b"], name="b", line=dict(color="#ff7f0e"),
    fill="tonexty", opacity=0.25       # shade between b and previous trace
))
fig.update_layout(
    title="Shaded region between a and b",
    template="plotly_white",
    hovermode="x unified"
)
fig.show()
```

Alternative (plot the difference as an area to zero):

```python
diff = df["a"] - df["b"]
fig = go.Figure(go.Scatter(y=diff, name="a - b", fill="tozeroy",
                           line=dict(color="orange")))
fig.update_layout(title="Difference a - b", template="plotly_white")
fig.show()
```

---

## 3D Surface

Plotly expects a **regular 2D grid** for surfaces. Build a grid and evaluate
`Z=f(X,Y)`.

```python
import numpy as np, plotly.graph_objects as go

x = np.linspace(1, 5, 50)
y = np.linspace(10, 30, 50)
X, Y = np.meshgrid(x, y)
Z = 600 - 100*X - (Y - 20)**2

fig = go.Figure(go.Surface(x=X, y=Y, z=Z, colorscale="RdYlBu"))
fig.update_layout(
    title="3D surface",
    template="plotly_white",
    scene=dict(xaxis_title="x", yaxis_title="y", zaxis_title="z")
)
fig.show()
```

If you only have scattered `(x,y,z)` points, use `go.Scatter3d(mode="markers")`
or grid/interpolate first (e.g., `scipy.interpolate.griddata`) and then draw a
surface.

---

## Scatter Matrix (pairwise relationships)

```python
import plotly.express as px

fig = px.scatter_matrix(
    df, dimensions=list("abcd"),
    title="Scatter matrix",
    template="plotly_white"
)
fig.update_traces(diagonal_visible=False, marker=dict(opacity=0.7, size=6))
fig.show()
```

Notes:

- For large frames, consider sampling to maintain interactivity.
- Use `color=some_category` to color points by groups.

---

## Faceting and Small Multiples

```python
long = df.assign(idx=np.arange(len(df))).melt(id_vars="idx", var_name="col", value_name="val")
fig = px.line(long, x="idx", y="val", facet_col="col", facet_col_wrap=2,
              title="Small multiples by column", template="plotly_white")
fig.for_each_annotation(lambda a: a.update(text=a.text.split("=")[-1]))
fig.show()
```

Why:

- Facets avoid overplotting and make comparisons across series clearer.

---

## Subplots (mix plot types)

```python
from plotly.subplots import make_subplots
import plotly.graph_objects as go

fig = make_subplots(rows=2, cols=2, subplot_titles=("Scatter", "Histogram", "Box", "Bar"))

fig.add_trace(go.Scatter(x=df["a"], y=df["b"], mode="markers", name="a vs b"), row=1, col=1)
fig.add_trace(go.Histogram(x=df["a"], name="a hist", nbinsx=25),            row=1, col=2)
fig.add_trace(go.Box(y=df["c"], name="c box"),                               row=2, col=1)
fig.add_trace(go.Bar(x=df2["category"], y=df2["values"], name="df2 bars"),   row=2, col=2)

fig.update_layout(height=700, width=900, title_text="Mixed subplots", template="plotly_white", showlegend=False)
fig.show()
```

---

## Styling Essentials

```python
fig.update_layout(
    title="Title",
    xaxis_title="X label",
    yaxis_title="Y label",
    legend=dict(orientation="h", yanchor="bottom", y=1.02, xanchor="right", x=1),
    margin=dict(l=60, r=20, t=60, b=50),
    template="plotly_white"
)

fig.update_traces(
    marker=dict(size=10, line=dict(width=0.5, color="black")),
    selector=dict(mode="markers")   # target only marker traces
)
```

Color control:

- Discrete: `color_discrete_sequence=['#1f77b4', '#ff7f0e', ...]`
- Continuous: `color_continuous_scale="Viridis"` (when using `color=` with
  numeric data in Plotly Express).

---

## Exporting

```python
# Self-contained HTML
fig.write_html("figure.html", include_plotlyjs="cdn", full_html=True)

# Static images (requires kaleido)
fig.write_image("figure.png", width=1200, height=700, scale=2)
fig.write_image("figure.pdf")
```

---

## Performance Tips

- Downsample large datasets for interactive use.
- Use `render_mode="webgl"` (e.g., in `px.scatter`) when plotting tens of
  thousands of points.
- Avoid excessive subplots with heavy traces; split into pages or facets.

---

## Troubleshooting

- If a trace doesn’t appear, check axis ranges (`fig.update_xaxes(range=[...])`,
  `fig.update_yaxes(range=[...])`).
- If colors look odd, confirm you’re using a **discrete** vs **continuous**
  color argument appropriately.
- If tooltips are too busy, control content with `hover_data` (Plotly Express)
  or `hovertemplate` (Graph Objects).

---
